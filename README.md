# Lab 8 â€” Kubernetes Migration for ML Services

ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ: Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ (PySpark), Ğ²Ğ¸Ñ‚Ñ€Ğ¸Ğ½Ğ° (Spark/Scala), Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Redis) Ğ² ĞºĞ»Ğ°ÑÑ‚ĞµÑ€ Kubernetes. Ğ¡ Helm Chart Ğ¸ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ Ñ€ĞµÑÑƒÑ€ÑĞ½Ñ‹Ğ¼Ğ¸ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°Ğ¼Ğ¸.

## ğŸ¯ Ğ¦ĞµĞ»ÑŒ
ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ²Ñ‹ĞºĞ¸ Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ² Ğ² Kubernetes, Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ¸ Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ´Ğ»Ñ Spark Ğ¸ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ Ñ‚Ñ€Ñ‘Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ².

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Model svc  â”‚â—„â”€â”€â–º â”‚  Data Mart  â”‚ â—„â”€â”€ â”‚   Redis svc    â”‚     â”‚  Spark on K8s â”‚
â”‚  (PySpark)  â”‚     â”‚ (Spark/Scala)â”‚    â”‚ (storage bus) â”‚     â”‚ (Driver/Execs)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚

### Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- kubectl, Kubernetes cluster (minikube/kind/eks/aks/gke)
- Helm 3+
- Docker

### Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°
```bash
helm upgrade --install lab8 ./charts/lab8 \
  --set model.image=ghcr.io/osadcijm84/lab5-model:latest \
  --set source.image=ghcr.io/osadcijm84/lab6-source:latest \
  --set mart.image=ghcr.io/osadcijm84/lab7-mart:latest
```

ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°:
```bash
kubectl get pods,svc
```

ĞÑ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸:

- Helm Ñ‡Ğ°Ñ€Ñ‚ Ğ²ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ `dist/model-lab5-1.0.0.zip` ĞºĞ°Ğº `ConfigMap` Ğ¸ Ñ‡ĞµÑ€ĞµĞ· `initContainer` Ñ€Ğ°ÑĞ¿Ğ°ĞºĞ¾Ğ²Ñ‹Ğ²Ğ°ĞµÑ‚ ĞµĞ³Ğ¾ Ğ² `/opt/model`.
- ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ğ°Ğ¼ Ñ‡ĞµÑ€ĞµĞ· Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½ÑƒÑ `MODEL_DIR=/opt/model`.

## ğŸ”§ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°
- `charts/lab8/values.yaml` â€” Ğ¾Ğ±Ñ€Ğ°Ğ·Ñ‹, Ñ€ĞµÑÑƒÑ€ÑÑ‹, Redis
- ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ñ€Ğ°Ğ·Ğ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ Ğ² `Secret`/`ConfigMap`, ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñ‹ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² `templates/`

## ğŸ”„ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
- Ğ Ğ¾Ğ»Ğ»Ğ¸Ğ½Ğ³-Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· `Deployment` Ğ¿Ñ€Ğ¸ ÑĞ¼ĞµĞ½Ğµ Ñ‚ĞµĞ³Ğ° Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ°
- ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ: Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº â†’ Ğ²Ğ¸Ñ‚Ñ€Ğ¸Ğ½Ğ° â†’ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ (Ğ¸Ğ»Ğ¸ Ğ½Ğ°Ğ¾Ğ±Ğ¾Ñ€Ğ¾Ñ‚ Ğ¿Ğ¾ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸ÑĞ¼)

## ğŸ“š Ğ¡ÑÑ‹Ğ»ĞºĞ¸
- Spark on K8s: https://spark.apache.org/docs/latest/running-on-kubernetes.html
- Ğ“Ğ°Ğ¹Ğ´: https://habr.com/ru/companies/neoflex/articles/511734/

## ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
```bash
a. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² Redis
b. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸ Ğ¿Ğ¾Ğ´Ğ¾Ğ² Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¸ Ğ²Ğ¸Ñ‚Ñ€Ğ¸Ğ½Ñ‹
```

## ğŸ“ ĞÑ‚Ñ‡Ñ‘Ñ‚
Ğ¡Ğ¼. `docs/REPORT.md`.
